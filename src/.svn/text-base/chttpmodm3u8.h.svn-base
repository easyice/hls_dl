/*
    <one line to give the program's name and a brief idea of what it does.>
    Copyright (C) 2012  elva <email>

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/


#ifndef CHTTPMODULEM3U8_H
#define CHTTPMODULEM3U8_H

#include "chttpmodbase.h"


class CHttpModM3u8 : public CHttpModBase
{
public:
	CHttpModM3u8();
	~CHttpModM3u8();
	
	virtual SEND_RES_T ProcessNewRequest(SP_HttpRequest * request,CONNECTION_T* pConn);
	
	virtual int OnRequestContinue(CONNECTION_T* pConn);
	
protected:
	virtual int OnRequest(SP_HttpRequest * request,CONNECTION_T* pConn,int& status);

	virtual SEND_RES_T HttpSendBuffer(CONNECTION_T* pConn,bool bAddHead);
	
	virtual void GenHttpHead(int content_len);
        
private:
        /**
         * @brief 初始化Session，分配TS读取及M3u8生成模块，打开文件
         */
        bool InitSession(SP_HttpRequest* request,SESSION_T* pSession);
        
        /**
         * @brief 判断请求是否含多码率节目
         */
        bool IsMultiRateReq(SP_HttpRequest* request);
        
        bool GenMultiRateList(SP_HttpRequest* request);
};

#endif // CHTTPMODULEM3U8_H
